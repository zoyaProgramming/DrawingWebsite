

<div style=" width: fit-content; padding:10px; height: fit-content; display: block;"> 
    <h1><%=typeof(id)==='undefined'?"Save":`Update ${name}`%></h1>
    <input name = 'method' id="method_final" type="hidden" value="submit">
    <input name = '1_id' id="1234" type="hidden" value=<%=id%>>
    <form id = 'formmain' method="post"> 
        <style>
            label{
                font-size: 15px;
                display: block
            }
            input{
                display: block;
                margin: auto;
            }
        </style>
       
        <label for="name_input">enter name</label>
        <input type='text' name="name" id="name_input">
        <label for="description_input">enter description: </label>
        <input type='text' name="description" id="description_input">
        <button type = 'submit' onclick="socks(event)">
    </form>
</div>

<script>
    
   async function saveOrUpdate() {
        const idInput = document.getElementById('id_input')
    
        if(idInput.value !== 'undefined' && idInput.value !== '') {
            console.log('id not undefined' + idInput.value)
            const formData = new FormData()
            formData.append('name', document.getElementById('name_input').value)
            const test3 = document.getElementById('drawing_data').value
            console.log('saveForm: test3')
            formData.append('id', document.getElementById('id_input').value)
            formData.append('method', document.getElementById('method_final').value)
            
            const response = await fetch(`/drawingapp/draw/${idInput.value}/update`, {
                method: 'post',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',

                },
                body:`name=${document.getElementById('name_input').value}&id=${document.getElementById('id_input').value}&method=${document.getElementById('method_final').value}&drawing_data=${document.getElementById('drawing_data').value}`
                
                //encodeURIComponent({"drawing_data": document.getElementById('drawing_data').value, "balls": "ball"})
            }).then((response) => {
                console.log(response.text())
            })
            
        } else {
            console.log('id undefined')
            const response =  fetch('/drawingapp/save', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',

                },
                body:`name=${document.getElementById('name_input').value}&id=${document.getElementById('id_input').value}&method=${document.getElementById('method_final').value}&drawing_data=${document.getElementById('drawing_data').value}`
            }).then((response)=> {
                idInput.value = response.body
            })
        }
    }


    function socks(event) {
        console.log('socks')
        
        saveOrUpdate().then(() =>{
            const idInput = document.getElementById('formmain')
            //idInput.submit()

        })
        event.preventDefault()
        
    }
</script> 

<%if(typeof(drawing_data) !== 'null') { %>
       
    <script src = '/javascripts/optional.js' defer></script>
<%}%>